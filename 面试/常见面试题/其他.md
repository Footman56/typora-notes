

接口幂等：

1. 提现时生成唯一的token， 返回给前端，前端请求时携带这个to ken， 检查是否有效果，有效就处理，处理完成失效token

2. 数据库唯一索引防重
3. 数据库乐观锁控制字段 （增加版本字段，符合版本才能操作）
4. 分布式锁防止并发 redis 
5. 事物与回滚机制， 插入和更新在一个事务里面
6. 结果缓存和快速响应，缓存这次操作的结果







mysql 与es 保证一致性

1. 代码中同步写 

2. 事务提交后异步更新

   ```java
   MySQL 事务提交成功
       ↓
   发送 MQ 消息
       ↓
   消费端更新 ES
   ```

3. Binlog 同步 

   ```java
   MySQL 写入
       ↓
   生成 binlog
       ↓
   Canal 监听 binlog
       ↓
   转换为 ES 文档
       ↓
   写入 ES
     
   # 不侵入业务代码，天然与事务绑定
   ```

   要有兜底：有重试机制



401: 没登陆   403 鉴权失败