# 消息实时通信

# 轮询

### 短轮询

指定时间间隔由浏览器向服务器发起HTTP请求。 （定时请求由服务器压力）

### 长轮询

```
Client ----请求----> Server
        <----挂起----
(有数据/超时)
        <----响应----
Client 再发请求
```



Spring MVC  DeferredResult

```java
@GetMapping("/poll")
public DeferredResult<String> poll() {
    DeferredResult<String> result = new DeferredResult<>(30000L);
    new Thread(() -> {
        try {
            Thread.sleep(10000);
            result.setResult("new message");
        } catch (Exception e) {
            result.setErrorResult("error");
        }
    }).start();

    return result;
}
# 缺点：仍配置线程池，高并发需要TaskExecutor
```

Spring webFlux

```java
@GetMapping(value = "/poll", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public Flux<String> poll() {
    return Flux.interval(Duration.ofSeconds(10))
               .map(seq -> "new message");
}

基于netty 非阻塞IO 
```



高并发场景下推荐使用 WebFlux 或 WebSocket。