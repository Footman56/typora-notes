# 项目经验

项目描述：通过图表形式展示绩效的个人考核，指标考核，我的团队下成员绩效，绩效校准等级分布。
项目实现：elactricsearch+mysql 形式来存储数据，负责数据结构设计，数据查询优化，数据定期校准。
项目效果：查询通常在2s以内返回结果，无慢查询，内存问题。

难点在于：es 与mysql 数据出现不一致的情况。导致的原因是多线程同时操作es的一个文档时导致冲突写失败。

问题原因是：e s采用_seq_no 和 `_primary_term`来实现乐关锁。

解决方式有两个：

1. 晚上定时将mysql数据同步到es中，根据表中有更新时间再今天内操作的mysql记录，再同步到es中，这个方案不好，因为mysql数据量太大了，并且有好多没必要处理的数据
2. 在发生同步异常时，将错误的数据记录下来，发送到rabbitmq队列里面，由队列的消费者重新去更新es。 