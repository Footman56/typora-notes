用于对数据进行统计，分析。

聚合可以分为3大类

+ 存储桶聚合：可以理解为sql 中的group by ，根据某一条件进行分组，之后对分组内的数据进行统计分析，效果是将文档分组到存储桶中

+ 指标聚合：可以理解为对字段进行计算，例如 avg，

+ 管道聚合： 聚合是可以多层的，可以根据一条件聚合后再根据



格式：

```json

"aggregations" : {
    "<aggregation_name>" : {
        "<aggregation_type>" : { 
            <aggregation_body>
        },
        ["aggregations" : { [<sub_aggregation>]* } ]
    }
    [,"<aggregation_name_2>" : { ... } ]*

```

aggregation_name：  用户定义的聚合名称，，是唯一的，用于说明聚合实现的功能 ，可以理解为函数名称

aggregation_type： 聚合中的一个键，可以理解为函数类型，有一些固定选项，例如：terms，stats 或 geo-distance 

aggregation_body： 指定聚合的属性，与aggregation_type 有关

嵌套聚合：“在一层聚合之下再做聚合，在aggregation_name 层次下面，与aggregation_type 重名。注这种嵌套的不能出现多个aggregations、aggregation_type

aggregation_name_2： 另一组聚合名称



# 桶存储聚合

## 仅返回需要聚合的结果

设置 size =0 

这种不需要返回文档，请求更加有效率。注有的情况下还是需要进行搜索的

```json
curl tweet/_search
{
  "size": 0,
  "aggregations": {
    "my_agg": {
      "terms": {
        "field": "text"
      }
    }
  }
}
```



Range ： 左闭右开
