**一切的架构都是为了需求做设计的**

根据之前的tomcat 设计的。需要解决

+  接收客户端浏览器发送请求，处理其中Socket连接。将网络字节流与Request和Response对象的转化
+ 加载和管理Servlet，以及具体处理Request请求

*** 其实大多数项目设计都可以分成两部分：其中一部分用于与外界交互（根据相应的规则进行输入、输出），另一部分响应对应的操作（实际的业务）。在其中如果外界输入输出与实际业务处理的输入输出不匹配的话就要涉及到转换。如果业务比较复杂的话，就会有多个响应的处理器，那么就是对这些处理器进行管理：怎么获取处理器，什么时候调用，调用哪个处理器，调用之后怎么办，调用出错了又怎么办***

Tomcat设计了两个核心组件连接器（Connector）和容器（Container）来分别实现对应功能。

<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fd2d3424551464f9d6f4b28cc5b7ecb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?" alt="image.png" style="zoom:50%;" />

# Connector

负责与外界交流，封装了底层的网络通信（Socket 请求及响应处理），将Socket 输入转换封装为 Request 对象，交由Catalina 容器进行处理，处理请求完成后, Catalina 通过 Coyote 提供的Response 对象将结果写入输出流 。

<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51c5b3a6aa29485a860f4b410f559642~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?" alt="image.png" style="zoom:50%;" />

> 看到这里我们知道了Connector的核心作用，就是将Socket 输入转换封装为 Request 对象
>
> 并能提供Response 对象将结果写入输出流

## 结构

![image.png](https://gcore.jsdelivr.net/gh/Footman56/imageBeds/202302011436121.image)

+ endpoint : EndPoint用来实现TCP/IP协议的，作为Coyote 通信端点，即通信监听的接口，是具体Socket接收和发送处理器，是对**传输层**的抽象
+ Processor:  HTTP协议处理接口 。Processor是对应用层协议的抽象。处理HTTP请求，Processor接收来自EndPoint的Socket，读取字节流解析成Tomcat Request和Response对象，并通过Adapter将其提交到容器处理。
+ ProtocolHandler： 通过整合endpoint 、processor，实现了具体协议。Tomcat 按照协议和I/O 提供了 6 个实现类 ：
  1. Ajp3个：AjpNioProtocol 、AjpAprProtocol、AjpNio2Protocol
  2. HTTP3个：Http11NioProtocol、Http11Nio2Protocol、Http11AprProtocol。

+ Adapter: 将tomcat 的request 转换成标准 的ServletRequest ，连接器调用 CoyoteAdapter的Sevice方法，传入的是Tomcat Request对象，CoyoteAdapter负责将Tomcat Request转成ServletRequest，再调用容器的Service方法。

 # container

管理servlet 

![image.png](https://gcore.jsdelivr.net/gh/Footman56/imageBeds/202302011442713.image)

一个Server 可以有多个Service

一个Service 可以有多个Connector，但只有一个container，只有一个Engine

一个Engine有多个host

一个Host有多个Context，一个Context表示一个web应用【我们开发就写的是Context】

一个Context有多个Servlet



Engine：表示Catalina的Servlet引擎，用来管理多个虚拟站点，一个Service最多只能有一个

Engine，但是一个引擎可包含多个Host

Host：表示虚拟主机，或者说一个站点，可以给Tomcat配置多个虚拟主机地址，而一个虚拟主机下可包含多个

Context：Context 表示一个Web应用程序， 一个Web应用可包含多个Wrapper

Wrapper：表示一个Servlet，Wrapper 作为容器中的最底层